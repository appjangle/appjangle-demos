<!DOCTYPE html>
<html>

<head>
<link
	href="http://appjangle.com/assets/v02/bootstrap-2.2.2/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="http://appjangle.com/assets/v02/bootstrap-2.2.2/css/bootstrap-responsive.min.css"
	rel="stylesheet">
<link
	href="http://u1.linnk.it/qc8sbw/usr/apps/textsync/files/tomorrow.value.css"
	rel="stylesheet">

<script src="http://appjangle.com/js/v01/appjangle/appjangle.nocache.js"></script>
<script
	src="http://appjangle.com/assets/v02/prettify-small-1-Jun-2011/prettify.js"></script>
<script
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="demo_instant_data.js"></script>

<script>
	window.onNextwebOnedb = function(engine) {

		Appjangle.demos.initInstantDataDemo({
			wrapper : $(".instantDataExample"),
			engine : engine
		});
	};
	window.onload = function() {
		prettyPrint();
	}
</script>

<style>
</style>

</head>

<body>
	<div class="container-fluid">

		<!-- one.upload https://u1.linnk.it/qc8sbw/usr/apps/textsync/files/demo_instant_data_page -->
		<div class="row-fluid">
			<div class="span12">
				<h4>Summary</h4>
				<p>This demo allows to make posts to a status or message board.
					A text typed in the input box below will appear as item in a list
					below the input box upon clicking the [Post] button.</p>

			</div>
		</div>
		<div class="row-fluid">
			<div class="span12">
				<h4 style="margin-top: 30px;">Demo</h4>
			</div>
		</div>
		<div class="ajdemo" style="padding: 5px;">
			<div class="row-fluid">
				<div class="span12">
					<div class="instantDataExample hide"
						style="border: 1px solid #4C3C1B; padding: 15px;">
						<!-- one.download https://u1.linnk.it/qc8sbw/usr/apps/textsync/files/demo_instant_data_html -->


		<div class="row-fluid">
			<div class="input-append" style="border-radius: 3px;">

				<input class="postInput input-block-level" placeholder="What's up?"
					type="text"
					style="width: 80%; float: left;"></input>
				<button class="postButton btn btn-inverse input-small "
					type="button" style="width: 20%; max-width: 90px; float: left;">Post</button>
			</div>

		</div>


		<div class="row-fluid">
			<div class="span12">
				<p style="color: gray;" class="noPostsYet">No posts yet.</p>
				<ul class="media-list postList">

				</ul>
				<p>
					Total Posts: <span class="totalPosts">0</span>
				</p>
				
			</div>
		</div>


		<div class="postTemplate hide post"
			onMouseOver="this.style.backgroundColor='#F8F8F8'"
			onMouseOut="this.style.backgroundColor='#FFFFFF'">
			<a class="pull-left" href="#"> <img class="media-object"
				src="http://docs.google.com/drawings/d/1nL9LVuDNjakiFW9YL5t1QOMtUgn2bVIl4OAXpPS6pMw/pub?w=50&h=50">
				<!-- caesar small: src="http://docs.google.com/drawings/d/1p5QOqa_z14b5wy7dKYDXfsq8t9jFt3ZFqZxjwt8wpmk/pub?w=30&h=30" -->
				<!-- seal: src="http://docs.google.com/drawings/pub?id=13FdmIQDoL33MCPnMNyn7kxabBTGPCqhvxJYiRB2Cns0&w=30&h=30" -->
			</a>
			<div class="media-body">
				<h4 class="media-heading" style="font-size: 80%;">
					<span class="postTime hide">2:29</span> <span class="postAuthor">Caesar</span>
				</h4>
				<p>
					<span class="postText"></span>
				</p>
			</div>
			
		</div>

		<!-- one.end -->
					</div>
				</div>
			</div>
		</div>

		<div class="row-fluid">
			<div class="span12">
				<h4 style="margin-top: 30px;">Note</h4>
				<dl class="dl-horizontal">
					<dt style="font-size: 90%;">Embedded Database</dt>
					<dd>
						This demo runs with an embedded JavaScript database. The Appjangle
						client libraries allow to perform all types of queries directly in
						the memory of the local application. This allows for <em>high
							responsiveness</em>.
					</dd>

				</dl>
				<dl class="dl-horizontal" style="margin-top: 10px;">
					<dt style="font-size: 90%;">No Cloud Persistence</dt>
					<dd>
						The posts in this demo are not persisted in the Appjangle cloud.
						Please <a href="#transparentCloudPersistence">see the next
							demo to see how that can be done</a>.
					</dd>
				</dl>

			</div>
		</div>



		<div class="row-fluid">
			<div class="span12">
				<h4 style="margin-top: 30px;">Usage of Appjangle</h4>
				<p>
					Appjangle provides the local database containing the posted
					messages. The <a href="http://nextweb.io">Nextweb open source
						API</a> is used to interact with the Appjangle embedded database in
					this example.
				</p>
				<p>Following the annotated source code of this demo illustrating
					the use of Appjangle.</p>

				<div
					style="border: 1px; border-style: solid; border-color: gray; padding: 15px;">
					<p style="border-bottom: solid; padding-bottom: 5px;">
						<a
							href="https://github.com/appjangle/appjangle-demos/blob/master/src/main/js/demo_instant_data.js">demo_instant_data.js</a>
					</p>


					<p style="margin-left: 40px; font-size: 90%;">An embedded db
						server is started and a client session is created.</p>
					<pre class="prettyprint linenums:24">
// local db server to manage data
server = Nextweb.startServer(12322);
session = Nextweb.createSession();
</pre>
					<p style="margin-left: 40px; margin-top: -13px; font-size: 90%;">
						The <a href="http://nextweb.io/docs/nextweb-seed.value.html">seed
							operation</a> is used to seed a new root node in the Appjangle
						database. This root node works as the 'container' for all
						application data. All other data is appended as direct and
						indirect child nodes to this root node.
					</p>
					<pre class="prettyprint linenums:27">
// request for data node to store all posts
posts = session.seed("local");
</pre>
					<p style="margin-left: 40px; margin-top: -13px; font-size: 90%;">
						The <a
							href="http://nextweb.io/docs/nextweb-node-operation.value.html">node
							operation</a> is used to create a reference to a data type node. This
						data type node has been defined before with another Appjangle app.
						The data type can be shared between unlimited apps and allows to
						distinguish posted messages from other data stored in the database
						(see <a
							href="http://nextweb.io/docs/nextweb-data-pattern.value.html">property
							pattern</a>).
					</p>
					<pre class="prettyprint linenums:30">
// load data type for posts
postType = "http://slicnet.com/seed1/seed1/3/6/5/2/h/sd/aPost1";
aPost = session.node(postType);
</pre>
					<p style="margin-left: 40px; margin-top: -13px; font-size: 90%;">
						The requested seed node is resolved from the database server using
						the <a href="http://nextweb.io/docs/nextweb-get.value.html">get
							operation</a> (This will happen in real-time, since we are running a
						local embedded database server).
					</p>
					<pre class="prettyprint linenums:34">
// resolving request for data node
posts.get(function(posts) {
    // when data node loaded, show ui
    demo.initUi();
});

// submit a new post
demo.submitPost = function() {
</pre>
					<p style="margin-left: 40px; margin-top: -13px; font-size: 90%;">
						The <a
							href="http://nextweb.io/docs/nextweb-append-value.value.html">append
							operation</a> is used to append the text in the input to the
						<code>posts</code>
						seed node created above. The second append is used to assign the
						data type loaded above.
					</p>
					<pre class="prettyprint linenums:42">
    posts.append($(".postInput", wrapper).val()).append(aPost);
    $(".postInput", wrapper).val("");</pre>
					<p style="margin-left: 40px; margin-top: -13px; font-size: 90%;">
						The commit operation triggers a <a
							href="http://maxrohde.com/2012/05/06/onedb-architecture-and-design/#synchronization">synchronization</a>
						between client and 'server' (that's still the embedded local
						server).
					</p>
					<pre class="prettyprint linenums:44">
    session.commit().get(function() {
        demo.updatePosts();
        demo.updateTotal();
    });
};

demo.updateTotal = function() {</pre>
					<p style="margin-left: 40px; margin-top: -13px; font-size: 90%;">
						The <a
							href="http://nextweb.io/docs/nextweb-selectAll-property.value.html">selectAll(property)</a>
						operation is used to retrieve a list of all append children of the
						root node
						<code>posts</code>
						which have been marked with the post data type mentioned above.
						The length of this list is used to display the total number of
						posts.
					</p>
					<pre class="prettyprint linenums:53">
    posts.selectAll(aPost).get(function(postsList) {
        $(".totalPosts", wrapper).text(postsList.size());
    });
};

demo.updatePosts = function() {
    var i, item;</pre>
					<p style="margin-left: 40px; margin-top: -13px; font-size: 90%;">
						The <a
							href="http://nextweb.io/docs/nextweb-selectAll-property.value.html">selectAll(property)</a>
						is again used to retrieve a <a
							href="http://nextweb.io/docs/nextweb-entity-list.value.html">NodeList</a>
						with posts. The values of these nodes are then iterated through
						and they are displayed as text to elements in a post list.
					</p>
					<pre class="prettyprint linenums:61">
    posts.selectAll(aPost).get(function(postsList) {
        $(".postList", wrapper).empty();
        for (i=postsList.values().length-1; i>=0; i--) {
            item = demo.createItem();
            $(".postList", wrapper).append(item);
            
            $(".postText", item).text(postsList.values()[i]);
        }</pre>
					<p style="margin-left: 40px; margin-top: -13px; font-size: 90%;">
						The size of the retrieved NodeLit is used to trigger the display
						of a placeholder when no nodes are defined.</p>
					<pre class="prettyprint linenums:70">
        if (postsList.size() === 0) {
            $(".noPostsYet", wrapper).show();
        } else {
            $(".noPostsYet", wrapper).hide();
        }
    });
};
</pre>
				</div>
			</div>
		</div>
		<div class="row-fluid">
			<div class="span12">
				<h4 style="margin-top: 30px;">Files</h4>
				
				<table class="table table-hover table-condensed"
                    style="font-size: 90%;">
                    <tr>
                        <td><a
                        href="https://github.com/appjangle/appjangle-demos/blob/master/src/main/js/demo_instant_data.js">demo_instant_data.js</a></td>
                        <td>The application logic for the demo. See annotations
                            above.</td>
                    </tr>
                    <tr>
                        <td><a
                        href="https://github.com/appjangle/appjangle-demos/blob/master/src/main/js/demo_instant_data.html">demo_instant_data.html</a></td>
                        <td>The HTML page for the application.
                        </td>
                    </tr>
                    
                </table>
			</div>
		</div>
		<!-- one.end -->

	</div>
</body>
</html>
